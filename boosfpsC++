
if not getgenv then getgenv = function() return _G end end
local env = getgenv()

if not env.DragonFarmConfig then
    warn("âš ï¸ à¹„à¸¡à¹ˆà¸žà¸š Config! à¸à¸³à¸¥à¸±à¸‡à¹ƒà¸Šà¹‰à¸„à¹ˆà¸²à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™...")
    env.DragonFarmConfig = {
        SELL_THRESHOLD = 10000,
        MOVEMENT_SPEED = 1.5,
        ATTACK_DELAY = 0.03,
        
        FPS_BOOST_ENABLED = true,
        TARGET_FPS = 60,
        
        SHOW_FRUIT_GUI = true,
        SHOW_COIN_GUI = true,
        GUI_UPDATE_RATE = 0.5
    }
end

local CONFIG = env.DragonFarmConfig

--// ðŸ“¦ SERVICES & VARIABLES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

--// âœ… à¸›à¹‰à¸­à¸‡à¸à¸±à¸™ Infinite yield (à¸•à¸£à¸§à¸ˆà¸«à¸² folder à¸—à¸µà¹ˆà¹ƒà¸à¸¥à¹‰à¹€à¸„à¸µà¸¢à¸‡)
local Interactions = workspace:FindFirstChild("Interactions")
local Nodes = Interactions and Interactions:FindFirstChild("Nodes")
local FoodFolder = nil

if Nodes then
    FoodFolder = Nodes:FindFirstChild("Food") 
        or Nodes:FindFirstChild("LargeFoodNode") 
        or Nodes:FindFirstChild("Foods") 
        or Nodes:FindFirstChildWhichIsA("Folder")
end

if not FoodFolder then
    warn("âš ï¸ à¹„à¸¡à¹ˆà¸žà¸šà¹‚à¸Ÿà¸¥à¹€à¸”à¸­à¸£à¹Œ Food à¹ƒà¸™à¹‚à¸¥à¸à¸™à¸µà¹‰ â†’ à¸‚à¹‰à¸²à¸¡à¸à¸²à¸£à¸Ÿà¸²à¸£à¹Œà¸¡")
end


local CollectableNames = { "EdamameFoodModel", "KajiFruitFoodModel", "MistSudachiFoodModel" }

local FARM_WORLD = 125804922932357
local SELL_WORLD = 3475397644
local RANDOM_WORLDS = {
    3475419198, 3475422608, 3487210751,
    3623549100, 3737848045, 3752680052, 4174118306, 4728805070
}

local PATROL_POSITIONS = {
    Vector3.new(-266, 467, -394),
    Vector3.new(1757, 783, 672),
    Vector3.new(1420, 319, -1409),
    Vector3.new(1922, 620, -2566),
    Vector3.new(2226, 585, -4128),
    Vector3.new(330, 901, -4304),
    Vector3.new(-1433, 779, -4717),
    Vector3.new(-3031, 780, -4211),
    Vector3.new(-2643, 547, -2250),
    Vector3.new(-857, 401, -2132),
    Vector3.new(-828, 688, -3444),
    Vector3.new(-1819, 405, 170),
    Vector3.new(-1523, 962, 1150)
}





--// ðŸ›¡ï¸ REMOVE MOB DAMAGE
local function removeMobDamageRemote()
    local RS = game:GetService("ReplicatedStorage")
    local RemotesFolder = RS:WaitForChild("Remotes")

    local function killAllOnce()
        local removed = 0
        for _, obj in ipairs(RemotesFolder:GetDescendants()) do
            if obj.Name == "MobDamageRemote" then
                pcall(function() obj:Destroy() end)
                removed += 1
            end
        end
        return removed
    end

    task.spawn(function()
        for i = 1, 15 do
            local count = killAllOnce()
            if count > 0 then
                print(("ðŸ—‘ï¸ à¸¥à¸š MobDamageRemote x%d"):format(count))
            end
            task.wait(1)
        end

        RemotesFolder.DescendantAdded:Connect(function(obj)
            if obj.Name == "MobDamageRemote" then
                task.defer(function()
                    pcall(function() obj:Destroy() end)
                end)
            end
        end)
    end)
end

--// ðŸ‰ DRAGON FUNCTIONS
local function getAnyDragonRemote()
    local dragonsFolder = character:WaitForChild("Dragons")
    for _, dragon in pairs(dragonsFolder:GetChildren()) do
        local remotes = dragon:FindFirstChild("Remotes")
        if remotes and remotes:FindFirstChild("PlaySoundRemote") then
            return remotes.PlaySoundRemote
        end
    end
    return nil
end

local function spamAttack(targetPart)
    local remote = getAnyDragonRemote()
    if not remote then return false end
    
    local health = targetPart:FindFirstChild("Health")
    if not health then return false end

    while health and health.Value > 0 and targetPart.Parent do
        local args = {"Breath", "Destructibles", targetPart}
        remote:FireServer(unpack(args))
        task.wait(CONFIG.ATTACK_DELAY)
    end
    return true
end

--// ðŸŽ FOOD NODE FUNCTIONS
local function getAllAliveNodes()
    local aliveNodes = {}
    for _, subFolder in pairs(FoodFolder:GetChildren()) do
        for _, node in pairs(subFolder:GetDescendants()) do
            if (node.Name:lower():find("billboard") or node.Name:lower():find("trunk") or node:IsA("BasePart"))
            and node:FindFirstChild("Health")
            and node.Health.Value > 0 then
                table.insert(aliveNodes, node)
            end
        end
    end
    return aliveNodes
end

local function getClosestAliveNode()
    local nodeList = getAllAliveNodes()
    local closestNode, closestDist = nil, math.huge
    for _, node in pairs(nodeList) do
        local dist = (hrp.Position - node.Position).Magnitude
        if dist < closestDist then
            closestNode = node
            closestDist = dist
        end
    end
    return closestNode
end

local function collectNearbyFoods()
    for _, obj in pairs(workspace.Camera:GetChildren()) do
        for _, name in ipairs(CollectableNames) do
            if obj.Name == name then
                for _, part in pairs(obj:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CFrame = hrp.CFrame
                    end
                end
            end
        end
    end
end
--// ðŸšœ AUTO FARM (à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡: à¸•à¸£à¸§à¸ˆà¸‹à¹‰à¸³ + à¸§à¸²à¸£à¹Œà¸›à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´)
--// ðŸšœ AUTO FARM (à¸›à¸£à¸±à¸šà¸›à¸£à¸¸à¸‡: à¸•à¸£à¸§à¸ˆà¸‹à¹‰à¸³ + à¸§à¸²à¸£à¹Œà¸›à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´)
local function startAutoFarm()
    task.spawn(function()
        local retryCount = 0
        while true do
            local node = getClosestAliveNode()

            if node and node:FindFirstChild("Health") and node.Health.Value > 0 then
                -- âœ… à¸£à¸µà¹€à¸‹à¹‡à¸•à¸•à¸±à¸§à¸™à¸±à¸šà¹€à¸¡à¸·à¹ˆà¸­à¹€à¸ˆà¸­à¸•à¹‰à¸™à¹„à¸¡à¹‰
                retryCount = 0

                -- âœ… à¸§à¸²à¸£à¹Œà¸›à¹„à¸›à¸•à¹‰à¸™à¹„à¸¡à¹‰
                print("ðŸŒ³ à¸žà¸šà¸•à¹‰à¸™à¹„à¸¡à¹‰à¹ƒà¸à¸¥à¹‰à¸ªà¸¸à¸”:", node.Name)
                hrp.CFrame = node.CFrame + Vector3.new(0, 4, 0)
                spamAttack(node)

            else
                -- âŒ à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¸•à¹‰à¸™à¹„à¸¡à¹‰ â€” à¸•à¸£à¸§à¸ˆà¸‹à¹‰à¸³à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
                retryCount += 1
                warn(("âš ï¸ à¹„à¸¡à¹ˆà¸žà¸šà¸•à¹‰à¸™à¹„à¸¡à¹‰à¸£à¸­à¸šà¸—à¸µà¹ˆ %d â†’ à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹ƒà¸«à¸¡à¹ˆ..."):format(retryCount))
                task.wait(1)

                -- ðŸ” à¸¥à¸­à¸‡à¸„à¹‰à¸™à¸«à¸²à¹ƒà¸«à¸¡à¹ˆ
                local newNode = getClosestAliveNode()
                if newNode then
                    print("âœ… à¹€à¸ˆà¸­à¸•à¹‰à¸™à¹„à¸¡à¹‰à¹ƒà¸«à¸¡à¹ˆà¹à¸¥à¹‰à¸§:", newNode.Name)
                    hrp.CFrame = newNode.CFrame + Vector3.new(0, 4, 0)
                    spamAttack(newNode)
                else
                    -- ðŸš¶ à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹€à¸ˆà¸­à¹€à¸¥à¸¢ à¸¥à¸­à¸‡à¹€à¸”à¸´à¸™ patrol
                    warn("ðŸš¶ à¸à¸³à¸¥à¸±à¸‡à¹€à¸”à¸´à¸™à¸•à¸£à¸§à¸ˆà¸«à¸²à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸•à¹‰à¸™à¹„à¸¡à¹‰...")
                    for _, pos in ipairs(PATROL_POSITIONS) do
                        hrp.CFrame = CFrame.new(pos)
                        task.wait(CONFIG.MOVEMENT_SPEED)

                        local foundNode = getClosestAliveNode()
                        if foundNode then
                            print("ðŸŒ² à¹€à¸ˆà¸­à¸•à¹‰à¸™à¹„à¸¡à¹‰à¹ƒà¸«à¸¡à¹ˆà¸•à¸­à¸™ patrol:", foundNode.Name)
                            hrp.CFrame = foundNode.CFrame + Vector3.new(0, 4, 0)
                            spamAttack(foundNode)
                            break
                        end
                    end
                end
            end

            -- ðŸ• à¸•à¸£à¸§à¸ˆà¸—à¸¸à¸ 1 à¸§à¸´
            task.wait(1)
        end
    end)
end


local function startAutoCollect()
    task.spawn(function()
        while task.wait(1) do
            collectNearbyFoods()
        end
    end)
end

--// ðŸ’° SELL FUNCTIONS
local function sellAllItems()
    local resources = player:WaitForChild("Data"):WaitForChild("Resources")
    for _, item in ipairs({"Edamame", "KajiFruit", "MistSudachi"}) do
        local val = resources:FindFirstChild(item)
        if val and val.Value > 0 then
            local args = {{ ItemName = item, Amount = val.Value }}
            ReplicatedStorage:WaitForChild("Remotes"):WaitForChild("SellItemRemote"):FireServer(unpack(args))
            print("ðŸ’° à¸‚à¸²à¸¢:", item, "à¸ˆà¸³à¸™à¸§à¸™", val.Value)
        end
    end
end

local function startCheckInventory()
    task.spawn(function()
        while task.wait(1) do
            local resources = player:WaitForChild("Data"):WaitForChild("Resources")
            local eda  = resources:FindFirstChild("Edamame") and resources.Edamame.Value or 0
            local kaji = resources:FindFirstChild("KajiFruit") and resources.KajiFruit.Value or 0
            local mist = resources:FindFirstChild("MistSudachi") and resources.MistSudachi.Value or 0

            if eda >= CONFIG.SELL_THRESHOLD 
                or kaji >= CONFIG.SELL_THRESHOLD 
                or mist >= CONFIG.SELL_THRESHOLD then
                print("ðŸ“¦ à¸¡à¸µà¸‚à¸­à¸‡à¸–à¸¶à¸‡ " .. CONFIG.SELL_THRESHOLD .. " â†’ à¸§à¸²à¸£à¹Œà¸›à¹„à¸›à¸‚à¸²à¸¢...")
                task.wait(5)
                ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(SELL_WORLD, {})
                break
            end
        end
    end)
end

--// ðŸ‘ï¸ PLAYER MONITOR (à¸•à¸£à¸§à¸ˆà¸—à¸¸à¸ 1 à¸§à¸´ à¹à¸šà¸šà¹à¸¡à¹ˆà¸™à¸¢à¸³)
local function monitorPlayers()
    task.spawn(function()
        while true do
            task.wait(1) -- âœ… à¸•à¸£à¸§à¸ˆà¸—à¸¸à¸ 1 à¸§à¸´

            local currentPlace = game.PlaceId
            local playerCount = #Players:GetPlayers()

            -- ðŸ§â€â™‚ï¸ à¸–à¹‰à¸²à¸¡à¸µà¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™à¸­à¸·à¹ˆà¸™
            if playerCount > 1 then
                warn("âš ï¸ à¸žà¸šà¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™à¸­à¸·à¹ˆà¸™à¹ƒà¸™à¹€à¸‹à¸´à¸£à¹Œà¸Ÿà¹€à¸§à¸­à¸£à¹Œ â†’ à¹€à¸•à¸£à¸µà¸¢à¸¡à¸ªà¸¸à¹ˆà¸¡à¸§à¸²à¸£à¹Œà¸›à¹ƒà¸™ 3 à¸§à¸´...")
                task.wait(3)

                local randomWorld = RANDOM_WORLDS[math.random(1, #RANDOM_WORLDS)]
                pcall(function()
                    ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(randomWorld, {})
                end)

                print("ðŸŒ à¸§à¸²à¸£à¹Œà¸›à¹„à¸›à¹‚à¸¥à¸à¸ªà¸¸à¹ˆà¸¡:", randomWorld)
                task.wait(10) -- â³ à¸£à¸­à¹‚à¸«à¸¥à¸”à¹‚à¸¥à¸à¸à¹ˆà¸­à¸™à¸•à¸£à¸§à¸ˆà¹ƒà¸«à¸¡à¹ˆ
            end

            -- ðŸŒ à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¸­à¸¢à¸¹à¹ˆà¹‚à¸¥à¸à¹„à¸«à¸™
            if currentPlace ~= FARM_WORLD and currentPlace ~= SELL_WORLD then
                warn("ðŸš« à¸•à¸£à¸§à¸ˆà¸žà¸šà¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸à¹‚à¸¥à¸à¸Ÿà¸²à¸£à¹Œà¸¡à¸«à¸£à¸·à¸­à¸‚à¸²à¸¢ (PlaceId:", currentPlace, ") â†’ à¸§à¸²à¸£à¹Œà¸›à¸à¸¥à¸±à¸šà¹‚à¸¥à¸à¸Ÿà¸²à¸£à¹Œà¸¡")
                pcall(function()
                    ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(FARM_WORLD, {})
                end)

                task.wait(4) -- â³ à¸£à¸­à¹ƒà¸«à¹‰à¸§à¸²à¸£à¹Œà¸›à¹€à¸ªà¸£à¹‡à¸ˆà¸à¹ˆà¸­à¸™à¹€à¸£à¸´à¹ˆà¸¡à¸•à¸£à¸§à¸ˆà¹ƒà¸«à¸¡à¹ˆ
            else
                -- âœ… à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹‚à¸¥à¸à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¸•à¸£à¸§à¸ˆà¸‹à¹‰à¸³à¸—à¸¸à¸ 1 à¸§à¸´
                print("ðŸŸ¢ à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹‚à¸¥à¸à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡:", currentPlace)
            end
        end
    end)
end



--// ðŸŽ¨ GUI SYSTEM
local function createGUI()
    if game.CoreGui:FindFirstChild("FarmGUI") then
        game.CoreGui.FarmGUI:Destroy()
    end

    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FarmGUI"
    screenGui.ResetOnSpawn = false
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = game.CoreGui

    -- ðŸ’° Coin Display
    if CONFIG.SHOW_COIN_GUI then
        local coinLabel = Instance.new("TextLabel")
        coinLabel.Name = "CoinLabel"
        coinLabel.Size = UDim2.new(0, 250, 0, 60)
        coinLabel.Position = UDim2.new(0.5, -125, 0.05, 0)
        coinLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        coinLabel.BackgroundTransparency = 0.3
        coinLabel.BorderSizePixel = 0
        coinLabel.TextColor3 = Color3.fromRGB(255, 223, 0)
        coinLabel.TextStrokeTransparency = 0.5
        coinLabel.TextScaled = true
        coinLabel.Font = Enum.Font.GothamBold
        coinLabel.Text = "ðŸ’° Loading..."
        coinLabel.Parent = screenGui

        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = coinLabel

        task.spawn(function()
            local coinsValue = player:WaitForChild("Data"):WaitForChild("Currency"):WaitForChild("Coins")
            local lastCoins = coinsValue.Value
            
            while task.wait(CONFIG.GUI_UPDATE_RATE) do
                local current = coinsValue.Value
                local diff = current - lastCoins

                if diff > 0 then
                    coinLabel.TextColor3 = Color3.fromRGB(0, 255, 127)
                elseif diff < 0 then
                    coinLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
                else
                    coinLabel.TextColor3 = Color3.fromRGB(255, 223, 0)
                end

                coinLabel.Text = string.format("ðŸ’° %s", tostring(current))
                lastCoins = current
            end
        end)
    end

    -- ðŸŽ Fruit Display
    if CONFIG.SHOW_FRUIT_GUI then
        local fruitFrame = Instance.new("Frame")
        fruitFrame.Name = "FruitFrame"
        fruitFrame.Size = UDim2.new(0, 280, 0, 150)
        fruitFrame.Position = UDim2.new(0.5, -140, 0.15, 0)
        fruitFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        fruitFrame.BackgroundTransparency = 0.3
        fruitFrame.BorderSizePixel = 0
        fruitFrame.Parent = screenGui

        local frameCorner = Instance.new("UICorner")
        frameCorner.CornerRadius = UDim.new(0, 12)
        frameCorner.Parent = fruitFrame

        local fruits = {
            {name = "Edamame", icon = "ðŸ«˜", color = Color3.fromRGB(144, 238, 144)},
            {name = "KajiFruit", icon = "ðŸŠ", color = Color3.fromRGB(255, 165, 0)},
            {name = "MistSudachi", icon = "ðŸ‹", color = Color3.fromRGB(255, 255, 102)}
        }

        for i, fruit in ipairs(fruits) do
            local label = Instance.new("TextLabel")
            label.Name = fruit.name .. "Label"
            label.Size = UDim2.new(1, -20, 0, 40)
            label.Position = UDim2.new(0, 10, 0, (i-1) * 45 + 10)
            label.BackgroundTransparency = 1
            label.TextColor3 = fruit.color
            label.TextStrokeTransparency = 0.5
            label.TextScaled = true
            label.Font = Enum.Font.GothamBold
            label.TextXAlignment = Enum.TextXAlignment.Left
            label.Text = fruit.icon .. " Loading..."
            label.Parent = fruitFrame
        end

        task.spawn(function()
            local resources = player:WaitForChild("Data"):WaitForChild("Resources")
            while task.wait(CONFIG.GUI_UPDATE_RATE) do
                for i, fruit in ipairs(fruits) do
                    local val = resources:FindFirstChild(fruit.name)
                    if val then
                        local label = fruitFrame:FindFirstChild(fruit.name .. "Label")
                        if label then
                            label.Text = string.format("%s %s: %d", fruit.icon, fruit.name, val.Value)
                        end
                    end
                end
            end
        end)
    end
end

--// ðŸ”„ ANTI-AFK
local function startAntiAFK()
    task.spawn(function()
        local VIM = game:GetService("VirtualInputManager")
        while true do
            task.wait(180)
            VIM:SendKeyEvent(true, Enum.KeyCode.A, false, game)
            task.wait(0.1)
            VIM:SendKeyEvent(false, Enum.KeyCode.A, false, game)
        end
    end)
end




createGUI()
startAntiAFK()

local placeId = game.PlaceId

if placeId == FARM_WORLD then
    print("ðŸšœ à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹‚à¸¥à¸à¸Ÿà¸²à¸£à¹Œà¸¡ â†’ à¸—à¸³à¸‡à¸²à¸™à¸•à¸²à¸¡à¸›à¸à¸•à¸´")
    startAutoFarm()
    startAutoCollect()
    startCheckInventory()
    monitorPlayers()
    task.wait(5)
    removeMobDamageRemote()

elseif placeId == SELL_WORLD then
    print("ðŸ’° à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹‚à¸¥à¸à¸‚à¸²à¸¢ â†’ à¸‚à¸²à¸¢à¸‚à¸­à¸‡à¹à¸¥à¹‰à¸§à¸à¸¥à¸±à¸šà¹„à¸›à¸Ÿà¸²à¸£à¹Œà¸¡")
    task.wait(2)
    sellAllItems()
    task.wait(3)
    ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(FARM_WORLD, {})

else
    print("ðŸŒ à¸­à¸¢à¸¹à¹ˆà¸™à¸­à¸à¹‚à¸¥à¸à¸Ÿà¸²à¸£à¹Œà¸¡/à¸‚à¸²à¸¢ â†’ à¸§à¸²à¸£à¹Œà¸›à¸à¸¥à¸±à¸šà¸Ÿà¸²à¸£à¹Œà¸¡à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™")
    pcall(function()
        ReplicatedStorage.Remotes.WorldTeleportRemote:InvokeServer(FARM_WORLD, {})
    end)
    
    -- à¸«à¸¢à¸¸à¸”à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¹€à¸«à¸¥à¸·à¸­à¹„à¸¡à¹ˆà¹ƒà¸«à¹‰à¸£à¸±à¸™à¸•à¹ˆà¸­
    return
end
